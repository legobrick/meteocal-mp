<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fmt="http://java.sun.com/jsp/jstl/functions">
    <h:head>
        <title><ui:insert name="title">User Page</ui:insert></title>
        <script type="text/javascript">
            var resourcesUrl = "#{request.contextPath}/resources";
        </script>
        <script type="text/javascript" src="#{request.contextPath}/resources/js/main/require_config.js">
        </script>
        <ui:insert name="other-scripts">
            <script data-main="#{request.contextPath}/resources/js/main/app/index_main.js" src="#{request.contextPath}/resources/js/main/lib/require.js"></script>
        </ui:insert>
        <h:outputStylesheet name="webjars/font-awesome/4.2.0/css/font-awesome.css"/>
        <style type="text/css">
            .ui-icon.fa {
                text-indent:0px;
                background-image:none;
            }
        </style>
        <style type="text/css">
            .empyes , .calendarButton .fc-event-inner {
                background: #8debc9;
                border-color: #0abb93;
                border-radius:0px;
                height:25px;
                font-size:14px;
                background-image:-ms-linear-gradient(top, #8debc9 ,#0abb93  );
                background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#8debc9) , to(#0abb93 ));
                background-image:-webkit-linear-gradient(top, #8debc9 , #0abb93 );
                background-image:-o-linear-gradient(top, #8debc9 , #0abb93 );
                background-image:linear-gradient(top, #8debc9 , #0abb93 );
                background-image:-moz-linear-gradient(top,#8debc9 , #0abb93 );
            }
            .empmaybe , .calendarButton .fc-event-inner {

                background: #eab051;
                border-color: #eab051;
                border-width:1px;
                height:25px;
                font-size:14px;
                background-image:-ms-linear-gradient(top, #f9c166 ,#ebcd16  );
                background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#f9c166) , to(#ebcd16 ));
                background-image:-webkit-linear-gradient(top, #f9c166 , #ebcd16 );
                background-image:-o-linear-gradient(top, #f9c166 , #ebcd16 );
                background-image:linear-gradient(top, #f9c166 , #ebcd16 );
                background-image:-moz-linear-gradient(top,#f9c166 , #ebcd16 );


                border-radius:30px;
            }
            .empowner, .calendarButton .fc-event-inner  {

                font-size:14px;
                background-image:-ms-linear-gradient(top, #90C4FF, rgb(30,130,201));
                background-image:-webkit-gradient(linear, 0 0, 0 100%, from(#90C4FF), to(rgb(30,130,201)));
                background-image:-webkit-linear-gradient(top, #90C4FF, rgb(30,130,201));
                background-image:-o-linear-gradient(top, #90C4FF, rgb(30,130,201));
                background-image:linear-gradient(top, #90C4FF, rgb(30,130,201));
                background-image:-moz-linear-gradient(top, #90C4FF, rgb(30,130,201));
                color:#ffffff;
                height:25px;
                border-radius:30px;
            }
        </style>
        <h:outputStylesheet name="css/create_event.css"/>
        <h:outputStylesheet name="css/main.css"/>
    </h:head>
    <h:body  style="background-color:rgb(245,240,230)">
        <header id="head">
            <div id="title"><h1>WeatherCal</h1></div>
            <div id="main_buttons">
                <h:form id="header-form">
                    <ul>
                        <li>
                            <p:commandButton id="notification_button" value="Notifications"/>
                            <p:overlayPanel id="imagePanel" style="height:200px;width:300px" dynamic="true" for="notification_button" hideEffect="fade">
                                <p:dataScroller id="notification_event" value="#{eventManagerBean.loggedEventUsr('nonletto',true)}" var="event" chunkSize="4" style="float:left;width:300px;height:200px;margin-right:50px">
                                    <p:commandButton value="#{event.start.dayOfMonth} #{event.start.month} #{event.description}" update=":evDetail" style="width:200px;height:30px" oncomplete="PF('notificationDialog').show()" title="View Detail">
                                        <f:setPropertyActionListener value="#{event}" target="#{eventManagerBean.selectEvent}" />
                                    </p:commandButton>
                                </p:dataScroller>
                            </p:overlayPanel>
                            <p:dialog header="Event's Info" widgetVar="notificationDialog" modal="true" showEffect="clip" hideEffect="clip" resizable="false">
                                <p:outputPanel id="evDetail" style="text-align:center;">
                                    <p:panelGrid  columns="2" rendered="#{not empty eventManagerBean.selectEvent}" columnClasses="label,value">
                                        <h:outputText value="Name" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.description}" /> 
                                        <h:outputText value="Where" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.placeDescription}" /> 
                                        <h:outputText value="Start" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.start.hour}:#{eventManagerBean.selectEvent.start.minute}" /> 
                                        <h:outputText value="End" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.end.hour}:#{eventManagerBean.selectEvent.end.minute}" /> 
                                    </p:panelGrid>
                                    <div class="ui-grid ui-grid-responsive" style="width:200px">
                                        <div class="ui-grid-row">
                                            <div class="ui-grid-col-3">       <p:commandButton value="Join" action="#{eventManagerBean.changeAvailability('si')}" oncomplete="DoAllThese()" style="width:50px;height:25px"><f:param name="action" value="#{eventManagerBean.selectEvent.id}" />
                                                    <script type="text/javascript">
                                                        function DoAllThese() {
                                                           PF('myschedule').update();
                                                            PF('notificationDialog').hide();

                                                        }
                                                    </script>
                                                </p:commandButton></div>
                                            <div class="ui-grid-col-3" style="margin-left:10px">      <p:commandButton value="No"  action="#{eventManagerBean.changeAvailability('no')}" oncomplete="PF('notificationDialog').hide()" style="width:50px;height:25px"><f:param name="action" value="#{eventManagerBean.selectEvent.id}" /></p:commandButton></div>
                                            <div class="ui-grid-col-3" style="margin-left:10px">  <p:commandButton value="Maybe" action="#{eventManagerBean.changeAvailability('forsea')}" oncomplete="PF('notificationDialog').hide()" style="width:70px;height:25px"><f:param name="action" value="#{eventManagerBean.selectEvent.id}" /></p:commandButton></div>
                                        </div>
                                    </div>
                                </p:outputPanel>
                            </p:dialog>
                        </li>
                        <li>
                            <p:commandButton id="logout_button" value="Logout" action="#{loginBean.logout()}"/>
                        </li>
                    </ul>
                </h:form>
            </div>
        </header>

        <div id="container">
            <div id="content" class="column">
                <div class="innertube">
                    <ui:insert name="main-content">
                        <p:commandButton widgetVar="new_event_button" id="new-event" action="#{eventManagerBean.createNew()}" icon="fa fa-plus" value="New Event" style="display:none; width:8em; height:1.9em; font-size:1em;">
                        </p:commandButton>
                        <h:form>
                            <h:panelGrid style="width:100%;">
                                <p:schedule
                                    id="mySchedule"
                                    value="#{eventManagerBean.loggedEventiMese()}"
                                    style="margin-left:20px;margin-right:20px; color:rgb(29,129,201)"
                                    widgetVar="myschedule"
                                    timeZone="GMT+1"
                                    draggable="false"
                                    resizable="false"
                                    firstHour="0" >
                                    <p:ajax event="eventSelect" listener="#{eventManagerBean.onEventSelect}" />
                                    <p:growl autoUpdate="true"/>
                                    <!--update="eventDetails" oncomplete="PF('eventSchedDialog').show();"--> 
                                </p:schedule>
                            </h:panelGrid>
                            <p:dialog widgetVar="eventSchedDialog" header="Event Details" showEffect="clip" hideEffect="clip">
                                <h:panelGrid id="eventDetails" rendered="#{not empty eventManagerBean.selectEvent}" columns="2">
                                    <h:outputLabel for="title" value="Title:"/>
                                    <h:outputText id="title" value="#{eventManagerBean.selectEvent.description}"/>
                                </h:panelGrid>
                            </p:dialog>
                        </h:form>
                    </ui:insert>
                </div>
            </div>
            <div id="nav" class="column">
                <div class="innertube">
                    <div class="ui-grid ui-grid-responsive">
                        <div class="ui-grid-row">
                            <h:form style="width:100%">
                                <div class="ui-grid-col-1" style="width: 100%; padding-right: 92px; margin-right: -85px; margin-top: 2px;">
                                    <p:autoComplete id="user" multiple="false" value="#{searchUser.searched}" completeMethod="#{invitationUser.completeUser}"
                                                    var="user" itemLabel="#{user.email}" itemValue="#{user.email}" forceSelection="true">
                                        <p:column style="width:10%">
                                            <h:outputText value="#{user.firstName}"/>
                                        </p:column>

                                        <p:column>
                                            <h:outputText value="#{user.email}"/>
                                        </p:column>
                                    </p:autoComplete>
                                </div>
                                <div class="ui-grid-col-1" style="width:78px;">
                                    <p:commandButton value="Search" action="#{searchUser.searchUser()}" style=""></p:commandButton>
                                </div>
                            </h:form>
                        </div>
                    </div>
                    <div id="backboneForecast">
                        <div class="ui-grid-row">
                            <div class="ui-grid ui-grid-responsive">
                                <div class="ui-grid-row">
                                    <h3 class="nontext-center">Weather Forecast</h3>
                                </div>
                                <div id="place" class="ui-grid-row">
                                    <div class="nontext-center">
                                        <i class="fa fa-circle-o-notch fa-spin"></i>
                                    </div>
                                </div>
                                <div id="forecast_days"></div>
                            </div>
                        </div>
<!--                        <div class="ui-grid ui-grid-responsive" style="margin-right:10px; margin-top: 1em;">
                            <div class="ui-grid-row" style="height:50px">
                                <h3 style="margin-top:.4em;margin-bottom:.4em;font-weight:600;" class="nontext-center">Weather Forecast</h3>
                            </div>
                            <div class="ui-grid-row" style="height:50px; border-radius:10px;border-style:solid;border-width:3px;border-color:rgb(29,129,201)">
                                <div class="ui-grid-col-5" style="background-color:#ff55ff;border-color:#ff3300;border-bottom-left-radius:10px;border-top-left-radius:10px"></div>
                                <div class="ui-grid-col-5" style="background-color:#fff55f;"></div>
                                <div class="ui-grid-col-5" style="background-color:#fdfd5f;"></div>
                                <div class="ui-grid-col-5" style="background-color:#fffd5f;"></div>
                                <div class="ui-grid-col-5" style="background-color:#fff55f;border-bottom-right-radius:10px;border-top-right-radius:10px"></div>
                            </div>
                        </div>-->
                    </div>
                    <div style="margin-top:50px;margin-rigth:10px">
                        <h3 style="margin-top:.4em;margin-bottom:.4em;font-weight:600;" value="" class="text-center">Next events</h3>
                        <h:form id="form">
                            <p:dataScroller id="next_event" widgetVar="nextEvent" value="#{eventManagerBean.loggedEventUsr('si',true)}" var="event" chunkSize="5" style="margin-right:10px">
                                <p:outputPanel>
                                    <h:panelGrid columns="2" cellpadding="5">
                                        <p:commandButton value="#{event.start.dayOfMonth} #{event.start.month} #{event.description}" style="width:300px;height:30px; margin-top:5px;" update=":form:carDetail" oncomplete="PF('eventDialog').show()" title="View Detail">
                                            <f:setPropertyActionListener value="#{event}" target="#{eventManagerBean.selectEvent}" />
                                        </p:commandButton>
                                    </h:panelGrid>
                                </p:outputPanel>
                            </p:dataScroller>
                            <p:dialog header="Event's Info" widgetVar="eventDialog" modal="true" showEffect="clip" hideEffect="clip" resizable="false">
                                <p:outputPanel id="carDetail" style="text-align:center;">
                                    <p:panelGrid  columns="2" rendered="#{not empty eventManagerBean.selectEvent}" columnClasses="label,value">
                                        <h:outputText value="Name" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.description}" /> 
                                        <h:outputText value="Where" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.placeDescription}" /> 
                                        <h:outputText value="Start" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.start.hour}:#{eventManagerBean.selectEvent.start.minute}" /> 
                                        <h:outputText value="End" />
                                        <h:outputText value="#{eventManagerBean.selectEvent.end.hour}:#{eventManagerBean.selectEvent.end.minute}" /> 
                                    </p:panelGrid>
                                    <p:commandButton value="Edit" action="#{eventManagerBean.owner}"><f:param name="action" value="#{eventManagerBean.selectEvent.id}" /></p:commandButton>
                                    <p:commandButton value="Abbandona" action="#{eventManagerBean.changeAvailability('no')}"><f:param name="action" value="#{eventManagerBean.selectEvent.id}" /></p:commandButton>
                                </p:outputPanel>
                            </p:dialog>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>
        <footer class="footer">
            <div class="text-center">
                <h6>Copyright © 2015 WeatherCal. All Rights Reserved.</h6>
                <h7>Authors: <a href="mailto:polyp91@gmail.com">Paolo Polidori</a>, <a href="mailto:edemantimarco@gmail.com">Marco Edemanti</a></h7>
            </div>
        </footer>
    </h:body>
</html>